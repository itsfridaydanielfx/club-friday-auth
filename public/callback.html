<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{TITLE}}</title>
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>

  <div class="box" id="root"
       data-status="{{STATUS}}"
       data-code="{{CODE}}"
       data-stripe="{{STRIPE_URL}}"
       data-join="{{JOIN_SERVER_URL}}"
       data-ig="{{IG_URL}}"
       data-tag="{{CONTACT_TAG}}"
  >
    <div class="top">
      <div class="badge">ğŸ”</div>

      <div class="discordLogoWrap" aria-hidden="true" title="Discord">
        <svg class="discordLogoSvg" viewBox="0 0 127.14 96.36" role="img" aria-label="Discord">
          <path fill="currentColor" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69c-6.18,0-11.2-5.69-11.2-12.69s5-12.69,11.2-12.69S53.66,46,53.66,53,48.63,65.69,42.45,65.69Zm42.24,0c-6.18,0-11.2-5.69-11.2-12.69s5-12.69,11.2-12.69S95.9,46,95.9,53,90.87,65.69,84.69,65.69Z"/>
        </svg>
      </div>

      <div class="t">
        <div class="title">{{TITLE}}</div>
        <div class="sub">@itsfridaydaniel Â· Club Friday Tools</div>
      </div>
    </div>

    <div class="lead" id="msg">{{MESSAGE}}</div>

    <div class="grid" id="grid"></div>
    <div class="actions" id="actions" style="margin-top:14px;"></div>
    <div class="footer" id="footer"></div>
  </div>

  <script>
    const root = document.getElementById("root");
    const msgEl = document.getElementById("msg");

    const status = (root.dataset.status || "error").toLowerCase();
    const code = (root.dataset.code || "").toUpperCase();
    const stripe = root.dataset.stripe;
    const join = root.dataset.join;
    const ig = root.dataset.ig;
    const tag = root.dataset.tag;

    const grid = document.getElementById("grid");
    const actions = document.getElementById("actions");
    const footer = document.getElementById("footer");

    // âœ… kolor linka + PODKREÅšLENIE pod nickiem
    const LINK_STYLE =
      "color: rgba(232, 244, 255, 0.92) !important; " +
      "text-decoration: underline !important; " +
      "text-underline-offset: 3px !important; " +
      "text-decoration-thickness: 1px !important; " +
      "font-weight: 700 !important;";

    function card(html, cls="card") {
      const d = document.createElement("div");
      d.className = cls;
      d.innerHTML = html;
      return d;
    }

    function singleAction() {
      actions.classList.add("singleAction");
    }

    // âœ… w Electronie: klik w link ma iÅ›Ä‡ do normalnej przeglÄ…darki (przez opener)
    function link(href, text){
      const safeHref = String(href || "");
      const isElectron = (navigator.userAgent || "").includes("Electron");
      const onClick = isElectron
        ? `onclick="try{ if(window.opener){ window.opener.postMessage({type:'OPEN_EXTERNAL', url:'${safeHref.replace(/'/g,"&#39;")}'}, '*'); } }catch(e){} return false;"`
        : `target="_blank" rel="noreferrer"`;
      return `<a href="${safeHref}" style="${LINK_STYLE}" ${onClick}>${text}</a>`;
    }

    if (status === "ok") {
      grid.appendChild(card(`âœ… Status: <span class="ok">OK</span>`));
      grid.appendChild(card(`MoÅ¼esz wrÃ³ciÄ‡ do aplikacji â€” to okno zamknie siÄ™ automatycznie.`, "card muted"));

      singleAction();
      const closeBtn = document.createElement("button");
      closeBtn.className = "btn primary";
      closeBtn.textContent = "Zamknij okno";
      closeBtn.onclick = () => window.close();
      actions.appendChild(closeBtn);

      footer.textContent = "@itsfridaydaniel Â· Club Friday Tools";

      try { window.opener && window.opener.postMessage("DISCORD_OK", "*"); } catch(e) {}
      setTimeout(() => { try { window.close(); } catch(e) {} }, 350);

    } else if (code === "MISSING_ROLE") {
      root.classList.add("importantRole");

      msgEl.textContent =
        "Kup dostÄ™p (BLIK / Revolut / Karta), potem napisz do mnie na IG lub Discordzie, Å¼ebym nadaÅ‚ rolÄ™.";

      grid.appendChild(card(`â›” Brak aktywnej roli dostÄ™pu do Club Friday Tools.`));
      grid.appendChild(card(
        `ğŸ”‘ Odblokuj dostÄ™p przez pÅ‚atnoÅ›Ä‡, a potem napisz do mnie na Instagramie lub na Discordzie, Å¼ebym nadaÅ‚ ci rolÄ™ na Discordzie i dostÄ™p do aplikacji.`,
        "card muted"
      ));

      singleAction();
      const buy = document.createElement("a");
      buy.className = "btn gold";
      buy.href = stripe;
      buy.target = "_blank";
      buy.rel = "noreferrer";
      buy.textContent = "Kup dostÄ™p (BLIK / Revolut / Karta) â€¢ 19,99 zÅ‚ na 30 dni";
      actions.appendChild(buy);

      footer.innerHTML =
        `Po zakupie napisz do mnie na Instagramie ${link(ig, tag)} lub na Discordzie <strong>${tag}</strong>. ` +
        `âœ… Po otrzymaniu roli zaloguj siÄ™ w aplikacji.`;

    } else if (code === "NOT_IN_GUILD") {
      grid.appendChild(card(`âŒ Status: <span class="bad">ERROR</span> <span class="mono">${code}</span>`));
      grid.appendChild(card(`Nie jesteÅ› na serwerze Club Friday â€” doÅ‚Ä…cz i sprÃ³buj ponownie.`, "card muted"));

      singleAction();
      const a = document.createElement("a");
      a.className = "btn primary";
      a.href = join;
      a.target = "_blank";
      a.rel = "noreferrer";
      a.textContent = "DoÅ‚Ä…cz do serwera";
      actions.appendChild(a);

      footer.innerHTML = `Po doÅ‚Ä…czeniu wrÃ³Ä‡ do aplikacji i kliknij <strong>â€Zaloguj przez Discordâ€</strong>.`;

    } else {
      grid.appendChild(card(`âŒ Status: <span class="bad">ERROR</span> <span class="mono">${code || "UNKNOWN"}</span>`));
      grid.appendChild(card(`SprÃ³buj ponownie za chwilÄ™ albo uruchom logowanie jeszcze raz w aplikacji.`, "card muted"));

      singleAction();
      const closeBtn = document.createElement("button");
      closeBtn.className = "btn primary";
      closeBtn.textContent = "Zamknij okno";
      closeBtn.onclick = () => window.close();
      actions.appendChild(closeBtn);

      footer.textContent = "MoÅ¼esz zamknÄ…Ä‡ to okno.";
    }
  </script>
</body>
</html>
