<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{TITLE}}</title>
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>

  <div class="box" id="root"
       data-status="{{STATUS}}"
       data-code="{{CODE}}"
       data-stripe="{{STRIPE_URL}}"
       data-join="{{JOIN_SERVER_URL}}"
       data-ig="{{IG_URL}}"
       data-tag="{{CONTACT_TAG}}"
  >
    <div class="top">
      <div class="badge">ğŸ”</div>
      <div class="discordLogo">Discord</div>
      <div class="t">
        <div class="title">{{TITLE}}</div>
        <div class="sub">@itsfridaydaniel Â· Club Friday Tools</div>
      </div>
    </div>

    <div class="lead" id="msg">{{MESSAGE}}</div>

    <div class="grid" id="grid"></div>

    <div class="actions" id="actions" style="margin-top:14px;"></div>

    <div class="footer" id="footer"></div>
  </div>

  <script>
    const root = document.getElementById("root");
    const status = (root.dataset.status || "error").toLowerCase();
    const code = root.dataset.code || "";
    const stripe = root.dataset.stripe;
    const join = root.dataset.join;
    const ig = root.dataset.ig;
    const tag = root.dataset.tag;

    const grid = document.getElementById("grid");
    const actions = document.getElementById("actions");
    const footer = document.getElementById("footer");

    function card(html, cls="card") {
      const d = document.createElement("div");
      d.className = cls;
      d.innerHTML = html;
      return d;
    }
    function btn(text, href, cls) {
      const a = document.createElement("a");
      a.className = "btn " + cls;
      a.href = href;
      a.target = "_blank";
      a.rel = "noreferrer";
      a.textContent = text;
      return a;
    }
    function singleAction() {
      actions.classList.add("singleAction");
    }

    if (status === "ok") {
      grid.appendChild(card(`âœ… Status: <span class="ok">OK</span>`));
      grid.appendChild(card(`MoÅ¼esz wrÃ³ciÄ‡ do aplikacji â€” to okno zamknie siÄ™ automatycznie.`, "card muted"));

      singleAction();
      const closeBtn = document.createElement("button");
      closeBtn.className = "btn primary";
      closeBtn.textContent = "Zamknij okno";
      closeBtn.onclick = () => window.close();
      actions.appendChild(closeBtn);

      footer.textContent = "@itsfridaydaniel Â· Club Friday Tools";

      try { window.opener && window.opener.postMessage("DISCORD_OK", "*"); } catch(e) {}
      setTimeout(() => { try { window.close(); } catch(e) {} }, 350);
    } else {
      grid.appendChild(card(`âŒ Status: <span class="bad">ERROR</span> <span class="mono">${code}</span>`));
      grid.appendChild(card(`ğŸ’¥ Aplikacja moÅ¼e siÄ™ wysypaÄ‡, jeÅ›li strony ÅºrÃ³dÅ‚owe zmieniÄ… algorytmy dziaÅ‚ania.`, "card muted"));

      // CTA zaleÅ¼nie od bÅ‚Ä™du
      if (code === "NOT_IN_GUILD") {
        singleAction();
        actions.appendChild(btn("DoÅ‚Ä…cz do serwera", join, "primary"));
        footer.innerHTML = `Po doÅ‚Ä…czeniu wrÃ³Ä‡ do aplikacji i kliknij <strong>â€Zaloguj przez Discordâ€</strong>.`;
      } else if (code === "MISSING_ROLE") {
        actions.appendChild(btn("Kup dostÄ™p (Stripe / BLIK)", stripe, "gold"));
        actions.appendChild(btn("Napisz na IG", ig, "primary"));
        footer.innerHTML =
          `Po zakupie napisz do mnie na IG lub na Discordzie <strong>${tag}</strong>, Å¼ebym nadaÅ‚ rolÄ™.`;
      } else {
        singleAction();
        const retry = document.createElement("button");
        retry.className = "btn primary";
        retry.textContent = "Zamknij okno";
        retry.onclick = () => window.close();
        actions.appendChild(retry);
        footer.textContent = "MoÅ¼esz zamknÄ…Ä‡ to okno.";
      }
    }
  </script>
</body>
</html>
